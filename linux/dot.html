<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="formata√ß√£o, windows, linux, freebsd, bios, uefi, instala√ß√£o, balena, etcher, ventoy, os">
    <meta name="author" content="Cain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS-over-TLS (DoT)</title>
    <!--Social Media Open Graph-->
    <meta property="og:title" content="DNS over TLS (DoT)"/>
    <meta property="og:url" content="https://cain-dev.github.io/default/"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="A requisi√ß√£o de DNS feita pra tudo que voc√™ conecta na internet n√£o tem nada de privacidade..."/>
    <meta property="og:image" content="https://raw.githubusercontent.com/cain-dev/default/main/assets/images/ogimage.jpg"/>
    <!--/Social Media Open Graph-->
    <!--Links-->
    <link rel="shortcut icon" href="../assets/images/cainlogo.ico">
    <link rel="stylesheet" type="text/css"href="../os_style.css">   
    <!--/Links-->
</head>
<body>
    <header id="main-header">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><p>@cain-dev</p></li>
            <li><a href="../extra/contact.html">Contato</a></li>
        </ul>
    </header>
	<main id="main-area">
        <h1>DNS over TLS (DoT)</h1>
        <h2>Introdu√ß√£o</h2>
        <p><i>O que diabos √© TLS e onde raios eu preciso disso na minha conex√£o?</i> Simples, a requisi√ß√£o feita pra tudo que voc√™ conecta na internet √© vis√≠vel, n√£o da pra saber o conte√∫do do pacote enviado para consulta de DNS e nem qual p√°gina espec√≠fica voc√™ est√° acessando, mas pra saber que voc√™ se conectou no servidor do <i>cornhub</i> da, e isso n√£o s√≥ viabiliza a invas√£o da sua privacidade como tamb√©m certos ataques... Convencido agora?</p>
        <p>√â algo t√£o oculto quanto sei l√°, navegar na rede TOR? N√£o, mas √© basicamente fazer dos seus requisitos de DNS como algo invis√≠vel para um intermedi√°rio com basicamente custo 0.</p>
        <p>Para isso voc√™ vai precisar dos pacotes <em>stubby</em>, <em>unbound</em> (e <em>expat</em> dependendo da distribui√ß√£o).</p>
        <h2>Configurando Unbound</h2>
        <p>Considerando que o unbound est√° instalado vamos fazer a configura√ß√£o inicial com:</p>
        <code>sudo unbound-control-setup</code>
        <p>Isso preparar os arquivos para a comunica√ß√£o segura.</p>
        <p>Ap√≥s isso, fa√ßa um backup do arquivo <mark>/etc/unbound/unbound.conf</mark>, e depois deixe ele com o conte√∫do abaixo:</p>
<pre><code>server:
  use-syslog: yes
  username: "unbound"
  directory: "/etc/unbound"
  trust-anchor-file: trusted-key.key
  root-hints: "/etc/unbound/root.hints"
  do-not-query-localhost:  no
forward-zone:
  name: "."
    forward-addr: 127.0.0.1@8053
    forward-addr: ::1@8053
</code></pre>
        <p>Ok, agora vamos baixar o arquivo de de lista de servidores raiz do DNS com o comando:</p>
        <code>curl --output /etc/unbound/root.hints https://www.internic.net/domain/named.cache</code>
        <p>Esse arquivo precisa ser atualizado com uma certa frequ√™ncia, para n√£o ter que fazer isso manualmente vamos criar um arquivo de servi√ßo em <mark>/etc/systemd/system/roothints.service</mark> com o conte√∫do:</p>
<pre><code>[Unit]
Description=Update root hints for unbound
After=network.target

[Service]
ExecStart=/usr/bin/curl -o /etc/unbound/root.hints https://www.internic.net/domain/named.cache
</code></pre>
        <p>E ent√£o criar o arquivo <mark>/etc/systemd/system/roothints.timer</mark> com o conte√∫do:</p>
<pre><code>[Unit]
Description=Run root.hints monthly

[Timer]
OnCalendar=monthly
Persistent=true

[Install]
WantedBy=timers.target
</code></pre>
        <p>E por fim vamos iniciar esse servi√ßo com o comando:</p>
        <code>systemctl enable roothints.timer</code>
        <h3>Configurando Stubby</h3>
        <p>Considerando que voc√™ tem o pacote stubby instalado, basta fazer um backup e depois configurar o <mark>/etc/stubby/stubby.yml</mark> como no exemplo abaixo:</p>
<pre><code>resolution_type: GETDNS_RESOLUTION_STUB
dns_transport_list:
  - GETDNS_TRANSPORT_TLS
tls_authentication: GETDNS_AUTHENTICATION_REQUIRED
tls_query_padding_blocksize: 256
edns_client_subnet_private: 1
round_robin_upstreams: 1
#idle_timeout: 10000
idle_timeout: 9000
listen_addresses:
  - 127.0.0.1@8053
  - 0::1@8053
upstream_recursive_servers:
  ## Cloudflare IPv4
  ## (NOTE: recommend reducing idle_timeout to 9000 if using Cloudflare)
  - address_data: 1.1.1.1
    tls_auth_name: "cloudflare-dns.com"
  - address_data: 1.0.0.1
    tls_auth_name: "cloudflare-dns.com"
  ## Cloudflare IPv6
  ## (NOTE: recommend reducing idle_timeout to 9000 if using Cloudflare)
  - address_data: 2606:4700:4700::1111
    tls_auth_name: "cloudflare-dns.com"
  - address_data: 2606:4700:4700::1001
    tls_auth_name: "cloudflare-dns.com"
</code></pre>
        <p><strong>Aten√ß√£o!</strong> Tome bastante cuidado com a sintaxe desse arquivo! A identa√ß√£o aqui possui sem√¢ntica, e n√£o se utiliza tabula√ß√£o e sim espa√ßos.</p>
        <p>Uma vez configurado inicie os servi√ßos:</p>
        <code>sudo systemctl enable stubby unbound</code>
        <h3>Configurando nameserver</h3>
        <p>Considerando que voc√™ est√° fazendo uso direto do <mark>/etc/resolv.conf</mark> (voc√™ taamb√©m pode usar o <em>openresolv</em> para gerenciar aqui, embora seja desnecess√°rio), basta deixar de conte√∫do as linhas abaixo:</p>
<pre><code>nameserver ::1
nameserver 127.0.0.1
options edns0 trust-ad
</code></pre>
        <p>Isso vai fazer com que seus requests de DNS sejam resolvidos localmente, depois disso recomendo deixar o arquivo <mark>/etc/resolv.conf</mark> imut√°vel com o comando:</p>
        <code>sudo chattr +i /etc/resolv.conf</code>
        <p>E se tudo deu certo voc√™ pode testar acessando <a class="link" href="https://one.one.one.one/help/">essa p√°gina</a> e verificar se a linha <em>Using DNS over TLS (DoT)</em> retorna <em>Yes</em>.</p>
        <h3>Finalizando</h3>
        <p>Agora eu recomendo que voc√™ ache uma solu√ß√£o tamb√©m para o <em>Network Time Security</em>...</p>
        </main>
    <footer id="main-footer">
        <p>Est√° p√°gina ainda est√° em constru√ß√£o üöß</p>
        <a class="footerlink" href="#main-header">‚Üë Retornar ao topo ‚Üë</a>
    </footer>
</body>
</html>
